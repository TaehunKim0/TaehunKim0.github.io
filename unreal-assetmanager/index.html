<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unreal AssetManager 분석과 사용 이유</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* 기본 스타일 */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
        }

        a {
            text-decoration: none;
            color: #4a90e2;
        }

        a:hover {
            text-decoration: underline;
        }

        /* 헤더 스타일 */
        header {
            background-color: #fff;
            padding: 20px 0;
            border-bottom: 1px solid #eee;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .header-container {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .header-title {
            font-size: 28px;
            font-weight: 700;
            color: #333;
        }

        .header-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }

        .header-nav li {
            margin-left: 25px;
        }

        .header-nav a {
            font-size: 16px;
            font-weight: 400;
            color: #555;
            transition: color 0.3s ease;
        }

        .header-nav a:hover {
            color: #000;
        }

        /* 메인 콘텐츠 스타일 (게시글 상세 페이지용) */
        main {
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .post-detail {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .post-detail .post-title {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .post-detail .post-meta {
            font-size: 15px;
            color: #888;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .post-detail .post-tags span {
            display: inline-block;
            background-color: #e0e0e0;
            color: #666;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 13px;
            margin-right: 8px;
            margin-top: 5px;
        }

        .post-detail .post-content {
            margin-top: 25px;
            font-size: 17px;
            color: #444;
        }

        /* 게시글 본문 내 스타일 */
        .post-content h2, .post-content h3, .post-content h4 {
            color: #333;
            margin-top: 35px;
            margin-bottom: 15px;
            font-weight: 700;
            line-height: 1.3;
        }
        .post-content h2 { font-size: 28px; }
        .post-content h3 { font-size: 24px; }
        .post-content h4 { font-size: 20px; }

        .post-content p {
            margin-bottom: 1em; /* 단락 간 간격 */
        }

        .post-content ul, .post-content ol {
            margin-left: 25px;
            margin-bottom: 1em;
        }
        .post-content li {
            margin-bottom: 0.5em;
        }
        
        /* 코드 블록 스타일 */
        .post-content pre {
            background-color: #282c34; /* Dark background for code */
            color: #abb2bf; /* Light text color */
            padding: 15px 20px;
            border-radius: 8px;
            overflow-x: auto; /* Horizontal scroll for long lines */
            margin: 25px 0;
            font-family: 'Roboto Mono', monospace; /* Monospace font for code */
            font-size: 15px;
            line-height: 1.4;
            white-space: pre-wrap; /* 자동 줄바꿈 */
        }

        .post-content code {
            font-family: 'Roboto Mono', monospace;
            font-size: 1em;
            background-color: #e0e0e0; 
            padding: 2px 5px;
            border-radius: 4px;
            color: #c7254e;
        }
        .post-content pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
            border-radius: 0;
        }

        /* 표 스타일 */
        .post-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
        }

        .post-content th, .post-content td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .post-content th {
            background-color: #f8f9fa;
            font-weight: 700;
        }

        .post-content tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        /* 푸터 스타일 */
        footer {
            text-align: center;
            padding: 30px 20px;
            margin-top: 50px;
            color: #777;
            font-size: 14px;
            border-top: 1px solid #eee;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="header-title">
                <a href="/">내 GitHub Pages</a>
            </div>
            <nav class="header-nav">
                <ul>
                    <li><a href="#">블로그</a></li>
                    <li><a href="#">태그</a></li>
                    <li><a href="#">소개</a></li>
                    <li><a href="https://github.com/TaehunKim0" target="_blank">GitHub</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <article class="post-detail">
            <h1 class="post-title">Unreal AssetManager 분석과 사용 이유</h1>
            <div class="post-meta">
                <span class="post-date">2025년 10월 1일</span>
                <div class="post-tags">
                    <span>#UnrealEngine</span>
                </div>
            </div>
            <div class="post-content">

                <h2>개요</h2>
                <hr>
                <p>GameFeature 를 사용하는 중에 AssetManager 와 스캔할 프라이머리 에셋 타입이라는 게 있어서, 공
                    부해보았다. 에셋 매니저를 사용하지 않아도, 게임은 만들 수 있다. 그럼 왜 필요한지 알아보자.</p>

                <br>
                <h2>에셋 매니저를 사용하는 이유</h2>
                <hr>
                1. 에셋 로드를 위해 경로를 직접 작성, 에디터에서 클래스 레퍼런스 연결하는 걸 막을 수 있다.
                <ul>
                    <li>에셋 경로를 직접 작성하고 있는 경우</li>
                    <!-- HTML generated using hilite.me --><div style="background: #262220; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%;"><span></span><span style="color: #DDD0C0">LoadObject(</span><span style="color: #C9B98F">&quot;/Game/Characters/Hero/BP_Hero.BP_Hero&quot;</span><span style="color: #DDD0C0">);</span>
</pre></div>

                    <li>에디터에서 레퍼런스를 연결하는 경우</li>
                    <!-- HTML generated using hilite.me --><div style="background: #262220; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%;"><span></span><span style="color: #DDD0C0">UPROPERTY(EditAnywhere, BlueprintReadWrite, Category </span><span style="color: #878787">=</span><span style="color: #DDD0C0"> </span><span style="color: #C9B98F">&quot;ABSGameState&quot;</span><span style="color: #DDD0C0">)</span>
<span style="color: #DDD0C0">TMap</span><span style="color: #878787">&lt;</span><span style="color: #DDD0C0">FGameplayTag, TSoftObjectPtr</span><span style="color: #878787">&lt;</span><span style="color: #919191">const</span><span style="color: #DDD0C0"> UBSCharacterDefinition</span><span style="color: #878787">&gt;&gt;</span><span style="color: #DDD0C0"> AvailableCharacterDefinitionMap;</span>
</pre></div>

                </ul>

                <br>

                2. 원하는 에셋을 원하는 때에 로드, 언로드할 수 있다.

                <br>
                <br>

                <p>위로 얻는 효과는 프로그래머의 실수를 방지하고, 메모리를 효율적으로 사용할 수 있다.</p>
                생각보다 사용 방법은 쉬웠다. 왜 진작 사용하지 않았을까?
            
                <br>
                <br>
                <h2>에셋 매니저 사용 방법</h2>
                <hr>

                <ul>
                    <li><b>에셋 매니저가 로드할 수 있는 에셋은 Primary Asset 뿐이다.</b></li>
                    <ul>
                        <li>기본적으로 UWorld(레벨) 에셋이 유일한 PrimaryAsset 이며, 상속 후에 GetPrimaryAssetId 함수를 오버라이드 하면 PrimaryAsset 이 된다. </li>
                        <li>PrimaryDataAsset 을 상속받은 BP 또는 DA 가 해당 된다.</li>
                    </ul>
                </ul>
                
                <ul>
                    <li><b>PrimaryAsset 은 이름 그대로 주요한 에셋으로, 직접 관리하고 싶은 최상위 에셋이다.</b></li>
                    <ul>
                        <li>PrimaryAsset 안에는 Secondary Asset 으로 구분된다. </li>
                        <li>Primary 이 SecondaryAsset 참조하거나 사용하려는 경우 언리얼 엔진이 자동으로 세컨더리 에셋을 로드한다.</li>
                    </ul>
                </ul>

                <ul>
                    <li>예제를 보면 UBSCharacterDefinition 은 PrimaryAsset, 멤버 변수는 SecondaryAsset 이다.</li>
                    <li><b>이제 PrimaryAssetID 로 경로나, 레퍼런스 필요 없이 검색하여 에셋을 가져올 수 있다.</b></li>

                </ul>
<pre style="font-family:monospace;color: rgb(216, 222, 233); background-color: rgb(46, 52, 64); font-weight: 400; "><span style="color: rgb(129, 161, 193); font-weight: 400;">class</span> <span style="color: rgb(143, 188, 187); font-weight: 400;">BISHOUJO_DOOM_API</span> UBSCharacterDefinition : <span style="color: rgb(129, 161, 193); font-weight: 400;">public</span> UPrimaryDataAsset
{
    <span style="color: rgb(143, 188, 187); font-weight: 400;">GENERATED_BODY</span>()

<span style="color: rgb(129, 161, 193); font-weight: 400;">public</span>:
    <span style="color: rgb(143, 188, 187); font-weight: 400;">UBSCharacterDefinition</span>();
    
<span style="color: rgb(129, 161, 193); font-weight: 400;">public</span>:
    <span style="color: rgb(136, 192, 208); font-weight: 400;"><span style="color: rgb(129, 161, 193); font-weight: 400;">virtual</span> FPrimaryAssetId <span style="color: rgb(143, 188, 187); font-weight: 400;">GetPrimaryAssetId</span><span style="color: rgb(216, 222, 233); font-weight: 400;">()</span> <span style="color: rgb(143, 188, 187); font-weight: 400;">const</span> <span style="color: rgb(129, 161, 193); font-weight: 400;">override</span>
    </span>{
       <span style="color: rgb(129, 161, 193); font-weight: 400;">return</span> <span style="color: rgb(143, 188, 187); font-weight: 400;">FPrimaryAssetId</span>(<span style="color: rgb(163, 190, 140); font-weight: 400;">"Character"</span>, CharacterTag.<span style="color: rgb(143, 188, 187); font-weight: 400;">GetTagLeafName</span>());
    }
    
    <span style="color: rgb(143, 188, 187); font-weight: 400;">UPROPERTY</span>(EditDefaultsOnly, Category = <span style="color: rgb(163, 190, 140); font-weight: 400;">"UBSCharacterDefinition"</span>)
    FGameplayTag CharacterTag;
    
    <span style="color: rgb(143, 188, 187); font-weight: 400;">UPROPERTY</span>(EditDefaultsOnly, Category = <span style="color: rgb(163, 190, 140); font-weight: 400;">"UBSCharacterDefinition"</span>)
    TArray&lt;FString&gt; GameFeaturesToEnable;

    <span style="color: rgb(143, 188, 187); font-weight: 400;">UPROPERTY</span>(EditDefaultsOnly, Instanced, Category=<span style="color: rgb(163, 190, 140); font-weight: 400;">"UBSCharacterDefinition"</span>)
    TArray&lt;TObjectPtr&lt;UGameFeatureAction&gt;&gt; DefaultGameFeatureActions;
    
    <span style="color: rgb(143, 188, 187); font-weight: 400;">UPROPERTY</span>(EditDefaultsOnly, Category=<span style="color: rgb(163, 190, 140); font-weight: 400;">"UBSCharacterDefinition"</span>)
    TObjectPtr&lt;<span style="color: rgb(143, 188, 187); font-weight: 400;">const</span> UBSPawnData&gt; DefaultPawnData;

    <span style="color: rgb(143, 188, 187); font-weight: 400;">UPROPERTY</span>(EditDefaultsOnly, BlueprintReadOnly, Category = <span style="color: rgb(163, 190, 140); font-weight: 400;">"UBSCharacterDefinition"</span>)
    TArray&lt;TObjectPtr&lt;UBSAbilitySet&gt;&gt; AbilitySets;

    <span style="color: rgb(143, 188, 187); font-weight: 400;">UPROPERTY</span>(EditdefaultsOnly, BlueprintReadOnly, Category = <span style="color: rgb(163, 190, 140); font-weight: 400;">"UBSCharacterDefinition"</span>)
    TSoftClassPtr&lt;USkeletalMesh&gt; TestSkeletalMeshClass;
};</pre>
                <br>

                <ul>
                    <li><b>프로젝트 세팅의 AssetManager 탭에서 스캔할 프라이머리 에셋 타입을 추가한다.</b></li>
                    <li><b>스캔</b>이라는 건 프로그래머가 로드할 에셋을 찾기 위해, 프라이머리 에셋의 타입과 에셋의 위치와 용도를 가지고 목록을 만드는 것이다.</li>
                    <image src="./images/DA.png" width="650" height="200"></image>
                    <image src="./images/Setting.png" width="650" height="250"></image>
                    <li>주의할 점은, 규칙의 쿠킹 관련된 옵션을 선택해주어야, 프로덕션과 개발 단계 둘 다 로드가 가능하다.</li>
                </ul>

                <br>
                
                <ul>
                    <li><b>AssetManager 를 사용해서 PrimaryAssetID 로 에셋을 검색해 로드할 수 있다.</b></li>
                    <ul>
                        <li>주의할 점: 커스텀 에셋매니저를 사용하려면 프로젝트 세팅에서 설정해주어야 한다.</li>
                    </ul>
                </ul>
             <pre style="font-family:monospace;color: rgb(216, 222, 233); background-color: rgb(46, 52, 64); font-weight: 400; "><span style="color: rgb(136, 192, 208); font-weight: 400;"><span style="color: rgb(143, 188, 187); font-weight: 400;">const</span> FPrimaryAssetId <span style="color: rgb(143, 188, 187); font-weight: 400;">CharacterDefID</span><span style="color: rgb(216, 222, 233); font-weight: 400;">(<span style="color: rgb(163, 190, 140); font-weight: 400;">"Character"</span>, InTag.GetTagLeafName())</span></span>;

<span style="color: rgb(76, 86, 106); font-weight: 400;">// 1. CharacterDefinition 비동기 로드</span>
UBSAssetManager::<span style="color: rgb(143, 188, 187); font-weight: 400;">Get</span>().<span style="color: rgb(143, 188, 187); font-weight: 400;">LoadCharacterDefinition</span>(CharacterDefID, FStreamableDelegate::<span style="color: rgb(143, 188, 187); font-weight: 400;">CreateLambda</span>([<span style="color: rgb(129, 161, 193); font-weight: 400;">this</span>, CharacterDefID, InPlayerState, InTag]()
{
    <span style="color: rgb(76, 86, 106); font-weight: 400;">// 2. CharacterDefinition 비동기 로드 완료</span>
    <span style="color: rgb(143, 188, 187); font-weight: 400;">const</span> <span style="color: rgb(129, 161, 193); font-weight: 400;">auto</span> LoadedCharacterDef = UBSAssetManager::<span style="color: rgb(143, 188, 187); font-weight: 400;">Get</span>().<span style="color: rgb(143, 188, 187); font-weight: 400;">GetPrimaryAssetObject</span>(CharacterDefID);
    <span style="color: rgb(129, 161, 193); font-weight: 400;">if</span> (!LoadedCharacterDef)
    {
       <span style="color: rgb(143, 188, 187); font-weight: 400;">UE_LOG</span>(LogBS, Warning, <span style="color: rgb(143, 188, 187); font-weight: 400;">TEXT</span>(<span style="color: rgb(163, 190, 140); font-weight: 400;">"Invalid LoadedCharacterDef"</span>));
       <span style="color: rgb(129, 161, 193); font-weight: 400;">return</span>;
    }
}</pre>
    

<pre style="font-family:monospace;color: rgb(216, 222, 233); background-color: rgb(46, 52, 64); font-weight: 400; "><span style="color: rgb(136, 192, 208); font-weight: 400;"><span style="color: rgb(143, 188, 187); font-weight: 400;">void</span> <span style="color: rgb(143, 188, 187); font-weight: 400;">UBSAssetManager::LoadCharacterDefinition</span><span style="color: rgb(216, 222, 233); font-weight: 400;">(<span style="color: rgb(143, 188, 187); font-weight: 400;">const</span> FPrimaryAssetId&amp; InCharacterDefinitionId,
                                              <span style="color: rgb(143, 188, 187); font-weight: 400;">const</span> FStreamableDelegate&amp; InLoadCompleteDelegate)</span>
</span>{
    <span style="color: rgb(76, 86, 106); font-weight: 400;">// 기본 에셋 경로 가져오기</span>
    <span style="color: rgb(143, 188, 187); font-weight: 400;">const</span> FSoftObjectPath AssetPath = <span style="color: rgb(143, 188, 187); font-weight: 400;">GetPrimaryAssetPath</span>(InCharacterDefinitionId);
    <span style="color: rgb(129, 161, 193); font-weight: 400;">if</span> (!AssetPath.<span style="color: rgb(143, 188, 187); font-weight: 400;">IsValid</span>())
    {
       <span style="color: rgb(143, 188, 187); font-weight: 400;">UE_LOG</span>(LogTemp, Error, <span style="color: rgb(143, 188, 187); font-weight: 400;">TEXT</span>(<span style="color: rgb(163, 190, 140); font-weight: 400;">"Invalid asset path for: %s"</span>), *InCharacterDefinitionId.<span style="color: rgb(143, 188, 187); font-weight: 400;">ToString</span>());
       InLoadCompleteDelegate.<span style="color: rgb(143, 188, 187); font-weight: 400;">ExecuteIfBound</span>();
       <span style="color: rgb(129, 161, 193); font-weight: 400;">return</span>;
    }
    
    <span style="color: rgb(76, 86, 106); font-weight: 400;">// 로드할 에셋 목록 구성</span>
    TArray&lt;FSoftObjectPath&gt; AssetsToLoad;
    AssetsToLoad.<span style="color: rgb(143, 188, 187); font-weight: 400;">Add</span>(AssetPath);
    
    <span style="color: rgb(76, 86, 106); font-weight: 400;">// 비동기 로딩 시작</span>
    <span style="color: rgb(143, 188, 187); font-weight: 400;">LoadAssetList</span>(AssetsToLoad, InLoadCompleteDelegate, FStreamableManager::AsyncLoadHighPriority);
}</pre>
                <br>

                <h3>프라이머리 에셋 로드 시</h3>
                <hr>
                 <ul>
                    <li><b>세컨더리 에셋인 TSoftClassPtr 의 TestSkeletalMeshClass 는 자동으로 로드가 된다.</b></li>
                    <ul>
                        <li>독립형 게임 모드에서도 확인 완료</li>
                        <li>자동으로 로드되지 않게 하려면, StreamableMananger 를 사용해 직접 로드해야 한다.</li>
                    </ul>
                </ul>
<pre style="font-family:monospace;color: rgb(216, 222, 233); background-color: rgb(46, 52, 64); font-weight: 400; ">FStreamableManager&amp; StreamableManager = UAssetManager::<span style="color: rgb(143, 188, 187); font-weight: 400;">GetStreamableManager</span>();
<span style="color: rgb(129, 161, 193); font-weight: 400;">auto</span> bLoadComplete = StreamableManager.<span style="color: rgb(143, 188, 187); font-weight: 400;">IsAsyncLoadComplete</span>(NewCharacterDef-&gt;TestSkeletalMeshClass.<span style="color: rgb(143, 188, 187); font-weight: 400;">ToSoftObjectPath</span>());
<span style="color: rgb(143, 188, 187); font-weight: 400;">UE_LOG</span>(LogBS, Log, <span style="color: rgb(143, 188, 187); font-weight: 400;">TEXT</span>(<span style="color: rgb(163, 190, 140); font-weight: 400;">"UBSCharacterDefManagerComponent::TestSkeletalMeshClass bLoadComplete = %d"</span>),  bLoadComplete);</pre>
                <ul>
                    <li><b>세컨더리 에셋 안의 자식들도 자동으로 로드가 된다.</b></li>
                 
                </ul>
           <pre style="font-family:monospace;color: rgb(216, 222, 233); background-color: rgb(46, 52, 64); font-weight: 400; "><span style="color: rgb(129, 161, 193); font-weight: 400;">auto</span> bLoadComplete = StreamableManager.<span style="color: rgb(143, 188, 187); font-weight: 400;">IsAsyncLoadComplete</span>(NewCharacterDef-&gt;TestSkeletalMeshClass.<span style="color: rgb(143, 188, 187); font-weight: 400;">ToSoftObjectPath</span>());
<span style="color: rgb(143, 188, 187); font-weight: 400;">UE_LOG</span>(LogBS, Log, <span style="color: rgb(143, 188, 187); font-weight: 400;">TEXT</span>(<span style="color: rgb(163, 190, 140); font-weight: 400;">"UBSCharacterDefManagerComponent::TestSkeletalMeshClass bLoadComplete = %d"</span>),  bLoadComplete);

bLoadComplete = StreamableManager.<span style="color: rgb(143, 188, 187); font-weight: 400;">IsAsyncLoadComplete</span>(NewCharacterDef-&gt;DefaultPawnData-&gt;TestPawnMeshClass.<span style="color: rgb(143, 188, 187); font-weight: 400;">ToSoftObjectPath</span>());
<span style="color: rgb(143, 188, 187); font-weight: 400;">UE_LOG</span>(LogBS, Log, <span style="color: rgb(143, 188, 187); font-weight: 400;">TEXT</span>(<span style="color: rgb(163, 190, 140); font-weight: 400;">"UBSCharacterDefManagerComponent::TestPawnMeshClass bLoadComplete = %d"</span>),  bLoadComplete);</pre>

                <ul>
                    <li><b>결론 : 프라이머리 에셋을 로드하면, 세컨더리 에셋들은 모두 자동으로 로드된다.</b></li>
                </ul>

                <br>
                <h3>결과</h3>
                <hr>
                <ul>
                    <li>프라이머리 에셋인 BSCharacterDefinition 을 AssetManager로 로드하는데 성공했으며, CharacterDefinition 의 CharacterTag 를 출력해서 확인하고 있다.</li>
                    <image src="./images/DA.png" width="600" height="200">
                    <image src="./images/AssetManagerLoad.png" width="600" height="300"></image>
                </ul>
            </div>
        </article>
    </main>

    <footer>
        <p>&copy; 2025 [TaehunKim0]. All rights reserved.</p>
    </footer>
</body>
</html>
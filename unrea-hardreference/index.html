<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>하드 레퍼런스의 문제점과 소프트 레퍼런스로 해결하는 방법</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* 기본 스타일 */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
        }

        a {
            text-decoration: none;
            color: #4a90e2;
        }

        a:hover {
            text-decoration: underline;
        }

        /* 헤더 스타일 */
        header {
            background-color: #fff;
            padding: 20px 0;
            border-bottom: 1px solid #eee;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .header-container {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .header-title {
            font-size: 28px;
            font-weight: 700;
            color: #333;
        }

        .header-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
        }

        .header-nav li {
            margin-left: 25px;
        }

        .header-nav a {
            font-size: 16px;
            font-weight: 400;
            color: #555;
            transition: color 0.3s ease;
        }

        .header-nav a:hover {
            color: #000;
        }

        /* 메인 콘텐츠 스타일 (게시글 상세 페이지용) */
        main {
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .post-detail {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .post-detail .post-title {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .post-detail .post-meta {
            font-size: 15px;
            color: #888;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .post-detail .post-tags span {
            display: inline-block;
            background-color: #e0e0e0;
            color: #666;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 13px;
            margin-right: 8px;
            margin-top: 5px;
        }

        .post-detail .post-content {
            margin-top: 25px;
            font-size: 17px;
            color: #444;
        }

        /* 게시글 본문 내 스타일 */
        .post-content h2, .post-content h3, .post-content h4 {
            color: #333;
            margin-top: 35px;
            margin-bottom: 15px;
            font-weight: 700;
            line-height: 1.3;
        }
        .post-content h2 { font-size: 28px; }
        .post-content h3 { font-size: 24px; }
        .post-content h4 { font-size: 20px; }

        .post-content p {
            margin-bottom: 1em; /* 단락 간 간격 */
        }

        .post-content ul, .post-content ol {
            margin-left: 25px;
            margin-bottom: 1em;
        }
        .post-content li {
            margin-bottom: 0.5em;
        }

        /* 코드 블록 스타일 */
        .post-content pre {
            background-color: #282c34; /* Dark background for code */
            color: #abb2bf; /* Light text color */
            padding: 15px 20px;
            border-radius: 8px;
            overflow-x: auto; /* Horizontal scroll for long lines */
            margin: 25px 0;
            font-family: 'Roboto Mono', monospace; /* Monospace font for code */
            font-size: 15px;
            line-height: 1.4;
        }

        .post-content code {
            font-family: 'Roboto Mono', monospace;
            font-size: 1em; /* Inherit from pre */
            background-color: #e0e0e0; /* Inline code background */
            padding: 2px 5px;
            border-radius: 4px;
            color: #c7254e; /* Inline code color */
        }
        .post-content pre code { /* Code inside pre should not have its own background */
            background-color: transparent;
            color: inherit;
            padding: 0;
            border-radius: 0;
        }

        /* 표 스타일 */
        .post-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
        }

        .post-content th, .post-content td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .post-content th {
            background-color: #f8f9fa;
            font-weight: 700;
        }

        .post-content tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        /* 푸터 스타일 */
        footer {
            text-align: center;
            padding: 30px 20px;
            margin-top: 50px;
            color: #777;
            font-size: 14px;
            border-top: 1px solid #eee;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="header-title">
                <a href="/">내 GitHub Pages</a>
            </div>
            <nav class="header-nav">
                <ul>
                    <li><a href="#">블로그</a></li>
                    <li><a href="#">태그</a></li>
                    <li><a href="#">소개</a></li>
                    <li><a href="https://github.com/TaehunKim0" target="_blank">GitHub</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <article class="post-detail">
            <h1 class="post-title">하드 레퍼런스의 문제점과 소프트 레퍼런스로 해결하는 방법</h1>
            <div class="post-meta">
                <span class="post-date">2025년 9월 18일</span>
                <div class="post-tags">
                    <span>#UnrealEngine</span>
                    <span>#C++</span>
                </div>
            </div>
            <div class = "start">
            <h2>개요</h2>
            <hr>
            언리얼 엔진에서 에셋을 참조하는 두 가지 방법, 하드 레퍼런스와 소프트 레퍼런스의 차이점을 알아보자
            특히 하드 레퍼런스가 왜 메모리 낭비와 로딩 시간 증가를 유발하는지 알아보고,
            이를 소프트 레퍼런스와 비동기 로딩으로 어떻게 해결했는지 살펴보자

            </div>
            <div class="post-content">

                <h2>하드 레퍼런스의 문제점</h2>
                <hr>
                <!-- HTML generated using hilite.me --><div style="background: #262220; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%;"><span></span><span style="color: #919191">class</span><span style="color: #DDD0C0"> </span><span style="color: #875F5F">BISHOUJO_DOOM_API</span><span style="color: #DDD0C0"> ATestCharacter </span><span style="color: #878787">:</span><span style="color: #DDD0C0"> </span><span style="color: #919191">public</span><span style="color: #DDD0C0"> AActor</span>
<span style="color: #DDD0C0">{</span>
<span style="color: #DDD0C0">    GENERATED_BODY()</span>
<span style="color: #DDD0C0">    </span>
<span style="color: #919191">public</span><span style="color: #878787">:</span><span style="color: #DDD0C0"> </span>
<span style="color: #DDD0C0">    ATestCharacter();</span>

<span style="color: #919191">protected</span><span style="color: #878787">:</span>
<span style="color: #DDD0C0">    </span><span style="color: #919191">virtual</span><span style="color: #DDD0C0"> </span><span style="color: #AF875F">void</span><span style="color: #DDD0C0"> BeginPlay() </span><span style="color: #919191">override</span><span style="color: #DDD0C0">;</span>

<span style="color: #919191">public</span><span style="color: #878787">:</span><span style="color: #DDD0C0"> </span>
<span style="color: #DDD0C0">    </span><span style="color: #919191">virtual</span><span style="color: #DDD0C0"> </span><span style="color: #AF875F">void</span><span style="color: #DDD0C0"> Tick(</span><span style="color: #AF875F">float</span><span style="color: #DDD0C0"> DeltaTime) </span><span style="color: #919191">override</span><span style="color: #DDD0C0">;</span>

<span style="color: #919191">public</span><span style="color: #878787">:</span>
<span style="color: #DDD0C0">    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category </span><span style="color: #878787">=</span><span style="color: #DDD0C0"> </span><span style="color: #C9B98F">&quot;Weapon&quot;</span><span style="color: #DDD0C0">)</span>
<span style="color: #DDD0C0">    USkeletalMesh</span><span style="color: #878787">*</span><span style="color: #DDD0C0"> WeaponMesh;</span>

<span style="color: #919191">public</span><span style="color: #878787">:</span>
<span style="color: #DDD0C0">    UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category </span><span style="color: #878787">=</span><span style="color: #DDD0C0"> </span><span style="color: #C9B98F">&quot;Components&quot;</span><span style="color: #DDD0C0">)</span>
<span style="color: #DDD0C0">    USkeletalMeshComponent</span><span style="color: #878787">*</span><span style="color: #DDD0C0"> MeshComponent;</span>
<span style="color: #DDD0C0">};</span>
</pre></div>

                <p><code>ATestCharacter</code>는 <code>WeaponMesh</code>를 하드 레퍼런스로 가지고 있다.</p>
                <!-- HTML generated using hilite.me --><div style="background: #262220; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%;"><span></span><span style="color: #DDD0C0">UCLASS()</span>
<span style="color: #919191">class</span><span style="color: #DDD0C0"> </span><span style="color: #875F5F">BISHOUJO_DOOM_API</span><span style="color: #DDD0C0"> ATestCharacterManager </span><span style="color: #878787">:</span><span style="color: #DDD0C0"> </span><span style="color: #919191">public</span><span style="color: #DDD0C0"> AActor</span>
<span style="color: #DDD0C0">{</span>
<span style="color: #DDD0C0">    GENERATED_BODY()</span>
<span style="color: #DDD0C0">    </span>
<span style="color: #919191">public</span><span style="color: #878787">:</span><span style="color: #DDD0C0"> </span>
<span style="color: #DDD0C0">    ATestCharacterManager();</span>

<span style="color: #919191">protected</span><span style="color: #878787">:</span>
<span style="color: #DDD0C0">    </span><span style="color: #919191">virtual</span><span style="color: #DDD0C0"> </span><span style="color: #AF875F">void</span><span style="color: #DDD0C0"> BeginPlay() </span><span style="color: #919191">override</span><span style="color: #DDD0C0">;</span>

<span style="color: #919191">public</span><span style="color: #878787">:</span><span style="color: #DDD0C0"> </span>
<span style="color: #DDD0C0">    </span><span style="color: #919191">virtual</span><span style="color: #DDD0C0"> </span><span style="color: #AF875F">void</span><span style="color: #DDD0C0"> Tick(</span><span style="color: #AF875F">float</span><span style="color: #DDD0C0"> DeltaTime) </span><span style="color: #919191">override</span><span style="color: #DDD0C0">;</span>

<span style="color: #919191">private</span><span style="color: #878787">:</span>
<span style="color: #DDD0C0">    UPROPERTY(EditAnywhere)</span>
<span style="color: #DDD0C0">    TSubclassOf TestClass;</span>
<span style="color: #DDD0C0">};</span>
</pre></div>

                <p><code>ATestCharacterManager</code>는 <code>ATestCharacter</code>의 클래스를 참조한다.
                    <p><code>TSubClassOf</code>: 클래스의 메타데이터와 타입 정보만 참조.</p>
                    <ul>
                        <li>클래스 타입을 변수로 저장하고 인스턴스 생성 시 사용.</li>
                        <li>CDO(기본 오브젝트) 포함.</li>
                        <li>CDO의 모든 하드 레퍼런스 에셋들이 함께 로드됨.</li>
                    </ul>
                    </p>
                <p><code>TestMap</code>의 사이즈맵에 <code>TestCharacterManager</code> 밑의 <code>TestCharacter</code>의 <code>SkeletalMesh</code>가 포함된다. 맵이 로딩될 때, 같이 로드 된다는 얘기이다.</p>
                <img src="./images/hard_sizemap.png" width="600" height="400">

                <h2>소프트 레퍼런스로 해결</h2>
                <hr>
                <!-- HTML generated using hilite.me --><div style="background: #262220; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%;"><span></span><span style="color: #919191">class</span><span style="color: #DDD0C0"> </span><span style="color: #875F5F">BISHOUJO_DOOM_API</span><span style="color: #DDD0C0"> ATestCharacter </span><span style="color: #878787">:</span><span style="color: #DDD0C0"> </span><span style="color: #919191">public</span><span style="color: #DDD0C0"> AActor</span>
<span style="color: #DDD0C0">{</span>
<span style="color: #DDD0C0">    GENERATED_BODY()</span>
<span style="color: #DDD0C0">    </span>
<span style="color: #919191">public</span><span style="color: #878787">:</span><span style="color: #DDD0C0"> </span>
<span style="color: #DDD0C0">    ATestCharacter();</span>

<span style="color: #919191">protected</span><span style="color: #878787">:</span>
<span style="color: #DDD0C0">    </span><span style="color: #919191">virtual</span><span style="color: #DDD0C0"> </span><span style="color: #AF875F">void</span><span style="color: #DDD0C0"> BeginPlay() </span><span style="color: #919191">override</span><span style="color: #DDD0C0">;</span>

<span style="color: #919191">public</span><span style="color: #878787">:</span><span style="color: #DDD0C0"> </span>
<span style="color: #DDD0C0">    </span><span style="color: #919191">virtual</span><span style="color: #DDD0C0"> </span><span style="color: #AF875F">void</span><span style="color: #DDD0C0"> Tick(</span><span style="color: #AF875F">float</span><span style="color: #DDD0C0"> DeltaTime) </span><span style="color: #919191">override</span><span style="color: #DDD0C0">;</span>

<span style="color: #DDD0C0">    </span><span style="color: #AF875F">void</span><span style="color: #DDD0C0"> </span><span style="color: #FDD0C0">OnCharacterAssetsLoaded</span><span style="color: #DDD0C0">();</span>

<span style="color: #919191">public</span><span style="color: #878787">:</span>
<span style="color: #DDD0C0">    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category </span><span style="color: #878787">=</span><span style="color: #DDD0C0"> </span><span style="color: #C9B98F">&quot;Weapon&quot;</span><span style="color: #DDD0C0">)</span>
<span style="color: #DDD0C0">    TSoftObjectPtr WeaponMesh;</span>
<span style="color: #DDD0C0">    </span>
<span style="color: #DDD0C0">    </span><span style="color: #70757A">// UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = &quot;Weapon&quot;)</span>
<span style="color: #DDD0C0">    </span><span style="color: #70757A">// USkeletalMesh* WeaponMesh;</span>
<span style="color: #DDD0C0">};</span>
</pre></div>

                <p><code>WeaponMesh</code>를 소프트 레퍼런스로 변경하였다.</p>
                <p><code>TestMap</code>의 사이즈맵에 <code>TestCharacter</code>의 메시가 포함되지 않는 것을 볼 수 있다.</p>
                <img src="./images/soft_sizemap.png" width="600" height="400">

                <h3>소프트 레퍼런스 에셋을 비동기로 로딩하는 방법</h3>
              <!-- HTML generated using hilite.me --><div style="background: #262220; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%;"><span></span><span style="color: #AF875F">void</span><span style="color: #DDD0C0"> </span><span style="color: #FDD0C0">ATestCharacter::BeginPlay</span><span style="color: #DDD0C0">()</span>
<span style="color: #DDD0C0">{</span>
<span style="color: #DDD0C0">    Super</span><span style="color: #878787">::</span><span style="color: #DDD0C0">BeginPlay();</span>

<span style="color: #DDD0C0">    </span><span style="color: #70757A">// 로드할 에셋들의 경로를 수집</span>
<span style="color: #DDD0C0">    TArray AssetsToLoad;</span>
<span style="color: #DDD0C0">    </span>
<span style="color: #DDD0C0">    </span><span style="color: #919191">if</span><span style="color: #DDD0C0"> (</span><span style="color: #878787">!</span><span style="color: #DDD0C0">WeaponMesh.IsNull())</span>
<span style="color: #DDD0C0">    {</span>
<span style="color: #DDD0C0">       AssetsToLoad.Add(WeaponMesh.ToSoftObjectPath());</span>
<span style="color: #DDD0C0">    }</span>

<span style="color: #DDD0C0">    </span><span style="color: #919191">if</span><span style="color: #DDD0C0"> (AssetsToLoad.Num() </span><span style="color: #878787">&gt;</span><span style="color: #DDD0C0"> </span><span style="color: #87AFAF">0</span><span style="color: #DDD0C0">)</span>
<span style="color: #DDD0C0">    {</span>
<span style="color: #DDD0C0">       </span><span style="color: #70757A">// 비동기 로딩 시작</span>
<span style="color: #DDD0C0">       UE_LOG(LogTemp, Warning, TEXT(</span><span style="color: #C9B98F">&quot;[SOFT_REF] 스켈레탈 메시 %d개 로딩중.....&quot;</span><span style="color: #DDD0C0">), AssetsToLoad.Num());</span>
<span style="color: #DDD0C0">       UE_LOG(LogTemp, Warning, TEXT(</span><span style="color: #C9B98F">&quot;[SOFT_REF] 로딩 시작 시간 : %f&quot;</span><span style="color: #DDD0C0">),GetWorld()</span><span style="color: #878787">-&gt;</span><span style="color: #DDD0C0">GetTimeSeconds());</span>
<span style="color: #DDD0C0">       </span>
<span style="color: #DDD0C0">       UAssetManager</span><span style="color: #878787">&amp;</span><span style="color: #DDD0C0"> AssetManager </span><span style="color: #878787">=</span><span style="color: #DDD0C0"> UAssetManager</span><span style="color: #878787">::</span><span style="color: #DDD0C0">Get();</span>
<span style="color: #DDD0C0">       FStreamableManager</span><span style="color: #878787">&amp;</span><span style="color: #DDD0C0"> StreamableManager </span><span style="color: #878787">=</span><span style="color: #DDD0C0"> AssetManager.GetStreamableManager();</span>
<span style="color: #DDD0C0">        </span>
<span style="color: #DDD0C0">       </span><span style="color: #919191">auto</span><span style="color: #DDD0C0"> AllAssetsLoadHandle </span><span style="color: #878787">=</span><span style="color: #DDD0C0"> StreamableManager.RequestAsyncLoad(</span>
<span style="color: #DDD0C0">          AssetsToLoad,</span>
<span style="color: #DDD0C0">          FStreamableDelegate</span><span style="color: #878787">::</span><span style="color: #DDD0C0">CreateUFunction(</span><span style="color: #919191">this</span><span style="color: #DDD0C0">, FName(</span><span style="color: #C9B98F">&quot;OnCharacterAssetsLoaded&quot;</span><span style="color: #DDD0C0">))</span>
<span style="color: #DDD0C0">       );</span>

<span style="color: #DDD0C0">       UE_LOG(LogTemp, Warning, TEXT(</span><span style="color: #C9B98F">&quot;[SOFT_REF] 로딩중에도 게임 계속 실행중.....&quot;</span><span style="color: #DDD0C0">));</span>
<span style="color: #DDD0C0">    }</span>
<span style="color: #DDD0C0">}</span>

<span style="color: #AF875F">void</span><span style="color: #DDD0C0"> </span><span style="color: #FDD0C0">ATestCharacter::OnCharacterAssetsLoaded</span><span style="color: #DDD0C0">()</span>
<span style="color: #DDD0C0">{</span>
<span style="color: #DDD0C0">    UE_LOG(LogTemp, Warning, TEXT(</span><span style="color: #C9B98F">&quot;[SOFT_REF] 캐릭터의 스켈레탈 메시 로딩 완료&quot;</span><span style="color: #DDD0C0">));</span>
<span style="color: #DDD0C0">    UE_LOG(LogTemp, Warning, TEXT(</span><span style="color: #C9B98F">&quot;[SOFT_REF] 로딩 완료 시간 : %f&quot;</span><span style="color: #DDD0C0">),GetWorld()</span><span style="color: #878787">-&gt;</span><span style="color: #DDD0C0">GetTimeSeconds());</span>

<span style="color: #DDD0C0">    </span><span style="color: #919191">if</span><span style="color: #DDD0C0"> (WeaponMesh.IsValid())</span>
<span style="color: #DDD0C0">    {</span>
<span style="color: #DDD0C0">       MeshComponent</span><span style="color: #878787">-&gt;</span><span style="color: #DDD0C0">SetSkeletalMesh(WeaponMesh.Get());</span>
<span style="color: #DDD0C0">    }</span>
<span style="color: #DDD0C0">    </span><span style="color: #919191">else</span>
<span style="color: #DDD0C0">    {</span>
<span style="color: #DDD0C0">       UE_LOG(LogTemp, Warning, TEXT(</span><span style="color: #C9B98F">&quot;[SOFT_REF] Weapon Mesh is unvalid.&quot;</span><span style="color: #DDD0C0">));</span>
<span style="color: #DDD0C0">    }</span>
<span style="color: #DDD0C0">}</span>
</pre></div>

                <p><code>AssetManager</code>를 사용해서 비동기로 로딩할 수 있다.</p>
                <img src="./images/log.png" width="600" height="400">
                <p>동기로 로딩하지 않는 이유는 로딩할 에셋이 큰 경우 게임이 끊기는 현상이 발생할 수 있기 때문이다.</p>
            </div>
        </article>
    </main>

    <footer>
        <p>&copy; 2025 [TaehunKim]. All rights reserved.</p>
    </footer>
</body>
</html>